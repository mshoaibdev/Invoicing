import{_ as ee}from"./AppDateTimePicker-1ad5c798.js";import{d7 as te,aB as k,am as ae,at as _,n as I,bk as o,b0 as t,p as h,y as a,de as le,bu as N,bt as v,cu as se,ab as oe,q as l,aU as c,x as b,o as D,cc as S,F as ne,aE as ie,cp as C,bx as x,cf as de,a5 as ue,bp as me,ac as ce}from"./main-70b82271.js";import{u as re}from"./invoices-9be41dd7.js";import{u as pe}from"./customers-88d4fab8.js";import{u as _e}from"./paymentMethods-25860e15.js";import{r as f,V as fe}from"./validators-f8585958.js";import{f as U}from"./formatters-12413ec5.js";import{a as ve}from"./index-628b2924.js";import{_ as be}from"./SendInvoice-714b41fc.js";import{a as g,V as m}from"./VRow-498fad85.js";import{V as Ve}from"./VAutocomplete-c6b44a42.js";import{V as T}from"./VTextarea-dd5d1a0b.js";import{a as he}from"./filter-73280f75.js";import"./lodash-bc5bedbb.js";import"./_commonjsHelpers-042e6b4d.js";import"./DialogCloseBtn-478619bf.js";import"./VCheckboxBtn-d416ecdf.js";import"./VSelectionControl-f8a2bfe4.js";const xe={key:0,class:"text-center pa-12"},ge=l("h2",{class:"p-4 text-center pt-2"}," Edit Invoice ",-1),ye=l("h6",{class:"text-sm font-weight-medium mb-3"}," Select Customer: ",-1),we={key:0,class:"scrollable-table"},ke=l("h6",{class:"text-sm font-weight-medium mt-2"}," Billed To: ",-1),De={class:"text-sm"},Ue={class:"mobileCardSize"},Ie=l("td",{class:"pe-6"}," Name: ",-1),Ce={class:"font-weight-semibold"},Te=l("td",{class:"pe-6"}," Address: ",-1),Se={key:0},Fe=l("br",null,null,-1),Me=l("td",{class:"pe-6"}," Phone: ",-1),Pe={key:0},$e=l("td",{class:"pe-6"}," Email: ",-1),Ye=l("span",{class:"me-3"},"Date of Invoice",-1),Le=l("span",{class:"me-3"},"Due Date ",-1),qe={class:"add-products-header mb-2 d-none d-md-flex"},Be=l("span",{class:"text-sm"}," Product Name ",-1),Ee=l("span",{class:"text-sm"}," Quantity ",-1),Ne=l("span",{class:"text-sm"}," Cost per item ",-1),Ae=l("span",{class:"text-sm"}," Total ",-1),ze={class:"pa-5 flex-grow-1"},Re={class:"text-sm-center my-2"},je=l("span",{class:"d-inline d-md-none"},"Price: ",-1),Qe={class:"text-body-1"},He={class:"d-flex flex-column justify-space-between border-s pa-1"},Ge={class:"mt-4 ma-sm-2"},Je=l("div",{class:"mx-sm-4 my-2"},null,-1),Ke={class:"my-2 mx-sm-4"},Oe=l("td",{class:"text-end"},[l("div",{class:"me-5"},[l("p",{class:"mb-2"}," Subtotal: "),l("p",{class:"mb-2"}," Tax: "),l("p",{class:"mb-2"}," VAT: "),l("p",{class:"mb-2"}," Total: ")])],-1),We={class:"font-weight-semibold"},Xe={class:"mb-2"},Ze={class:"mb-2"},et={class:"mb-2"},tt={class:"mb-2"},at=l("p",{class:"font-weight-semibold mb-2 mt-2"}," Terms and Conditions: ",-1),lt=l("p",{class:"font-weight-semibold mb-2 mt-2"}," Note: ",-1),st={class:"font-weight-medium text-h5 mb-3"},Dt={__name:"EditInvoice",setup(ot){const{customers:F,isLoading:A,fetchCustomersList:z}=pe(),{updateInvoice:R,respResult:j,isLoading:M,getInvoice:Q,invoiceData:P}=re(),{fetchPaymentMethodsList:H,paymentMethods:G,isLoading:J}=_e(),$=te().params.id,y=k(!1),w=k(),V=k({}),r=k({}),e=k({invoice_date:"",due_date:""});ae(async()=>{await z(),await Q($),await H(),e.value={...P.value},e.value.customer_id&&Y(e.value.customer_id)});const Y=u=>{const n=F.value.find(i=>i.id===u);V.value=n.currency,r.value={id:n.id,name:n.name,phone:n.phone,email:n.email,billing:n.billing}},L=()=>{e.value.total=0,e.value.total=parseFloat(e.value.subtotal)+parseFloat(e.value.tax_amount)+parseFloat(e.value.vat_amount)},q=()=>{e.value.subtotal=0,e.value.items.forEach(u=>{e.value.subtotal+=parseFloat(u.total)}),B()},B=()=>{e.value.tax_amount=0;const u=parseInt(e.value.tax_percentage);u>0&&e.value.subtotal>0&&(e.value.tax_amount=parseFloat(e.value.subtotal*u/100)),L()},K=()=>{e.value.vat_amount=0;const u=parseInt(e.value.vat_percentage);u>0&&e.value.subtotal>0&&(e.value.vat_amount=parseFloat(e.value.subtotal*u/100)),L()},E=u=>{const n=e.value.items[u],{cost:i,quantity:s}=n;n.total=parseInt(i)*parseInt(s),q()},O=()=>{e.value={...P.value},ce(()=>{var u,n;(u=w.value)==null||u.reset(),(n=w.value)==null||n.resetValidation()})},W=async()=>{var u;(u=w.value)==null||u.validate().then(async({valid:n})=>{if(n){const i=new FormData,s=e.value.items;i.append("customer_id",e.value.customer_id),i.append("due_date",e.value.due_date),i.append("invoice_date",e.value.invoice_date),i.append("total",e.value.total),i.append("subtotal",e.value.subtotal),i.append("tax_percentage",e.value.tax_percentage),i.append("tax_amount",e.value.tax_amount),i.append("vat_amount",e.value.vat_amount),i.append("vat_percentage",e.value.vat_percentage),i.append("note",e.value.note??""),i.append("terms",e.value.terms??""),i.append("payment_method_id",e.value.payment_method_id),i.append("status",e.value.status);for(let d=0;d<s.length;d++)i.append(`items[${d}][quantity]`,s[d].quantity),i.append(`items[${d}][description]`,s[d].description),i.append(`items[${d}][title]`,s[d].title),i.append(`items[${d}][cost]`,s[d].cost),i.append(`items[${d}][total]`,s[d].total);i.append("_method","PUT"),await R($,i),j.value.status===200&&O()}else ve.error("Form contains error, please check again")})},X=()=>{e.value.items.push({id:e.value.items.length+1,quantity:0,description:"",title:"",cost:0,total:0})},Z=u=>{e.value.items=e.value.items.filter(n=>n.id!==u),q()};return(u,n)=>{const i=ee;return _(),I(fe,{ref_key:"refForm",ref:w,onSubmit:me(W,["prevent"])},{default:o(()=>[t(e).customer_id?(_(),I(g,{key:1},{default:o(()=>[a(m,{cols:"12",md:"9"},{default:o(()=>[a(N,null,{default:o(()=>[ge,a(v,null,{default:o(()=>[a(g,null,{default:o(()=>[a(m,{cols:"12",md:"4"},{default:o(()=>[ye,a(Ve,{modelValue:t(e).customer_id,"onUpdate:modelValue":[n[0]||(n[0]=s=>t(e).customer_id=s),Y],items:t(F),"item-title":"name","item-value":"id",placeholder:"Select Customer",loading:t(A),rules:[t(f)],"menu-props":{maxHeight:300},density:"compact"},{item:o(({props:s,item:d})=>[a(se,oe(s,{subtitle:d.raw.email}),null,16,["subtitle"])]),_:1},8,["modelValue","items","loading","rules"]),t(r)?(_(),h("div",we,[ke,l("table",De,[l("tbody",null,[l("tr",Ue,[Ie,l("td",Ce,c(t(r).name),1)]),l("tr",null,[Te,t(r).billing?(_(),h("td",Se,[b(c(t(r).billing.address_street_1)+" "+c(t(r).billing.city)+" "+c(t(r).billing.state)+" "+c(t(r).billing.zip)+" ",1),Fe,b(" "+c(t(r).billing.country_name),1)])):D("",!0)]),l("tr",null,[Me,t(r).billing?(_(),h("td",Pe,c(t(r).billing.phone),1)):D("",!0)]),l("tr",null,[$e,l("td",null,c(t(r).email),1)])])])])):D("",!0)]),_:1}),a(m,{offset:"4",cols:"12",md:"4"},{default:o(()=>[a(g,null,{default:o(()=>[a(m,{cols:"12",md:"12"},{default:o(()=>[Ye,a(i,{modelValue:t(e).invoice_date,"onUpdate:modelValue":n[1]||(n[1]=s=>t(e).invoice_date=s),rules:[t(f)],density:"compact",placeholder:"DD-MM-YYYY",config:{position:"auto right",dateFormat:"Y-m-d",disableMobile:!0}},null,8,["modelValue","rules"])]),_:1}),a(m,{cols:"12",md:"12"},{default:o(()=>[Le,a(i,{modelValue:t(e).due_date,"onUpdate:modelValue":n[2]||(n[2]=s=>t(e).due_date=s),rules:[t(f)],density:"compact",placeholder:"DD-MM-YYYY",config:{position:"auto right",dateFormat:"Y-m-d",disableMobile:!0}},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(S),a(v,{class:"add-products-form"},{default:o(()=>[l("div",qe,[a(g,{class:"font-weight-medium px-4"},{default:o(()=>[a(m,{cols:"12",md:"6"},{default:o(()=>[Be]),_:1}),a(m,{cols:"12",md:"2"},{default:o(()=>[Ee]),_:1}),a(m,{cols:"12",md:"2"},{default:o(()=>[Ne]),_:1}),a(m,{cols:"12",md:"2"},{default:o(()=>[Ae]),_:1})]),_:1})]),(_(!0),h(ne,null,ie(t(e).items,(s,d)=>(_(),h("div",{key:s.title,class:"ma-sm-2 mb-2"},[a(N,{flat:"",border:"",class:"d-flex flex-row"},{default:o(()=>[l("div",ze,[a(g,null,{default:o(()=>[a(m,{cols:"12",md:"6"},{default:o(()=>[a(T,{modelValue:s.title,"onUpdate:modelValue":p=>s.title=p,rules:[t(f)],rows:"1",label:"Title"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(m,{cols:"12",md:"2"},{default:o(()=>[a(C,{modelValue:s.quantity,"onUpdate:modelValue":[p=>s.quantity=p,p=>E(d)],rules:[t(f)],type:"number",label:"Quantity",min:"0"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(m,{cols:"12",md:"2"},{default:o(()=>[a(C,{modelValue:s.cost,"onUpdate:modelValue":[p=>s.cost=p,p=>E(d)],rules:[t(f)],type:"number",min:"0",label:"Cost per item"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(m,{cols:"12",md:"2",sm:"4"},{default:o(()=>[l("p",Re,[je,l("span",Qe,c(t(U)(s.total,t(V).code??"USD")),1)])]),_:2},1024),a(m,{cols:"12",md:"12"},{default:o(()=>[a(T,{modelValue:s.description,"onUpdate:modelValue":p=>s.description=p,rows:"3",label:"Description"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),l("div",He,[a(x,{icon:"",size:"x-small",color:"default",variant:"text",disabled:d===0,onClick:p=>Z(s.id)},{default:o(()=>[a(de,{size:"20",icon:"tabler-x"})]),_:2},1032,["disabled","onClick"])])]),_:2},1024)]))),128)),l("div",Ge,[a(x,{onClick:X},{default:o(()=>[b(" Add Item ")]),_:1})])]),_:1}),a(S),a(v,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row ma-sm-2"},{default:o(()=>[a(g,null,{default:o(()=>[a(m,{cols:"12",md:"6"},{default:o(()=>[a(C,{modelValue:t(e).vat_percentage,"onUpdate:modelValue":[n[3]||(n[3]=s=>t(e).vat_percentage=s),K],label:"VAT Tax (%)",rules:[t(f)],type:"number",min:"0",max:"100"},null,8,["modelValue","rules"])]),_:1}),a(m,{cols:"12",md:"6"},{default:o(()=>[a(C,{modelValue:t(e).tax_percentage,"onUpdate:modelValue":[n[4]||(n[4]=s=>t(e).tax_percentage=s),B],label:"Select Tax (%)",rules:[t(f)],type:"number",min:"0",max:"100"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1}),a(v,{class:"d-flex justify-space-between flex-wrap flex-column flex-sm-row"},{default:o(()=>[Je,l("div",Ke,[l("table",null,[l("tr",null,[Oe,l("td",We,[l("p",Xe,c(t(U)(t(e).subtotal,t(V).code??"USD")),1),l("p",Ze,c(t(U)(t(e).tax_amount,t(V).code??"USD")),1),l("p",et,c(t(U)(t(e).vat_amount,t(V).code??"USD")),1),l("p",tt,c(t(U)(t(e).total,t(V).code??"USD")),1)])])])])]),_:1}),a(S),a(v,{class:"mx-sm-4"},{default:o(()=>[at,a(T,{modelValue:t(e).terms,"onUpdate:modelValue":n[5]||(n[5]=s=>t(e).terms=s),clearable:"",placeholder:"Enter your terms here...","clear-icon":"tabler-circle-x"},null,8,["modelValue"])]),_:1}),a(v,{class:"mx-sm-4"},{default:o(()=>[lt,a(T,{modelValue:t(e).note,"onUpdate:modelValue":n[6]||(n[6]=s=>t(e).note=s),clearable:"",placeholder:"Enter your note here...","clear-icon":"tabler-circle-x"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),a(m,{cols:"12",md:"3"},{default:o(()=>[a(v,null,{default:o(()=>[l("h6",st," Invoice #"+c(t(e).invoice_id),1),a(he,{modelValue:t(e).payment_method_id,"onUpdate:modelValue":n[7]||(n[7]=s=>t(e).payment_method_id=s),items:t(G),rules:[t(f)],loading:t(J),"item-title":"name","item-value":"id",label:"Payment Method",class:"mb-6"},null,8,["modelValue","items","rules","loading"]),a(x,{block:"",type:"submit","prepend-icon":"tabler-edit",loading:t(M),disabled:t(M),class:"mb-2",onClick:n[8]||(n[8]=s=>{var d;return(d=t(w))==null?void 0:d.validate()})},{default:o(()=>[b(" Update Invoice ")]),_:1},8,["loading","disabled"]),t(e).status==="Draft"||t(e).status==="Sent"?(_(),I(x,{key:0,block:"","prepend-icon":"tabler-send",class:"mb-2",onClick:n[9]||(n[9]=s=>y.value=!0)},{default:o(()=>[b(" Send Invoice ")]),_:1})):D("",!0),a(x,{block:"",class:"mb-2","prepend-icon":"tabler-download",href:t(e).invoice_link,target:"_blank",rel:"noopener noreferrer"},{default:o(()=>[b(" Download Invoice ")]),_:1},8,["href"]),a(x,{block:"","prepend-icon":"tabler-arrow-left",color:"secondary",class:"mb-2",variant:"tonal",to:{name:"invoices"}},{default:o(()=>[b(" Back to Invoices ")]),_:1})]),_:1})]),_:1})]),_:1})):(_(),h("div",xe,[a(le,{width:3,size:70,indeterminate:""})])),t(y)?(_(),I(be,{key:2,isDialogVisible:t(y),"onUpdate:isDialogVisible":n[10]||(n[10]=s=>ue(y)?y.value=s:null),invoice:t(e)},null,8,["isDialogVisible","invoice"])):D("",!0)]),_:1},8,["onSubmit"])}}};export{Dt as default};
