import{_ as re}from"./AppTextField-9867e25c.js";import{l as ue,d as ee,_ as ce,c as me}from"./VTextarea-bfeb20e3.js";import{_ as pe}from"./AppDateTimePicker-4011cefb.js";import{r as c,ae as ve,k as fe,a5 as te,a3 as _e,o as ye,a as N,f as Y,b as a,w as n,a6 as be,u as l,V as R,E as ae,d,t as F,h as se,F as le,p as Ve,g as Z,c as ge,U as he,ab as De,ac as we,af as Ie}from"./main-c40ee4ed.js";import{u as xe,c as ke,b as Ce}from"./Add-bc5c5574.js";import{a as I}from"./axios-da837377.js";import{l as y}from"./parse-263515be.js";import{l as x}from"./index.m-120058be.js";import{V as Se,r as D}from"./VForm-48297921.js";import{f as oe}from"./formatters-12413ec5.js";import{V as ne,a as ie}from"./VCard-a375baf5.js";import{a as de,V as p}from"./VRow-db2c24e9.js";import{V as Ue}from"./VDialog-fe67dd57.js";function $e(){const r=c(!1),b=c(null),k=c(null),z=[{title:"#Invoice ID",key:"invoice_number",sortable:!1},{title:"Customer Name",key:"customer.name",sortable:!1},{title:"Email",key:"customer.email",sortable:!1},{title:"Phone",key:"customer.phone",sortable:!1},{title:"Address",key:"customer.address",sortable:!1},{title:"Total",key:"total",sortable:!1},{title:"Status",key:"status",sortable:!1},{title:"Completion Date",key:"completion_date",sortable:!1},{title:"Due Date",key:"due_date",sortable:!1},{title:"Actions",key:"actions",sortable:!1}],U=ve({status:""}),w=c([]),s=c([]),_=c(10),V=c(0),C=c(1),P=c(1),O=[10,25,50,100],M=c(""),j=c("id"),A=c(!0),Q=c(null),$=c({}),T=c({}),G=fe(()=>{const e=w.value.length?(C.value-1)*_.value+1:0,t=w.value.length+(C.value-1)*_.value;return`Showing ${e} to ${t} of ${V.value} entries`}),H=()=>{k.value.refresh()},q=async e=>{try{r.value=!0;const t=await I.delete(x("invoices.destroy",e));b.value=t,y.success(t.data.message)}catch(t){console.log(t),y.error("Error! Deleting invoice")}finally{r.value=!1}},E=async e=>{const t=await I.get(x("invoices.show",e));$.value=t.data.data},B=async(e,t)=>{try{r.value=!0;const i=await I.post(x("invoices.update",e),t);b.value=i,y.success(i.data.message)}catch(i){i.response.status===422&&(T.value=i.response.data.errors),y.error(i.response.data.message)}finally{r.value=!1}},J=async(e,t)=>{try{r.value=!0;const i=await I.post(x("invoices.status",e),t);b.value=i,y.success(i.data.message)}catch(i){console.log(i),i.response.status===422&&y.error(i.response.data.message)}finally{r.value=!1}},K=async e=>{r.value=!0,await I.post(x("invoices.store"),e).then(t=>{b.value=t,y.success(t.data.message)}).catch(t=>{b.value=t,t.response.status===422&&y.error(t.response.data.message)}).finally(()=>{r.value=!1})},g=async()=>{r.value=!0;try{const e=await I.get(x("invoices.index"),{params:{q:M.value,perPage:_.value,page:C.value,sortBy:j.value,sortDesc:A.value,...U}}),{total:t,last_page:i}=e.data.meta;P.value=i,w.value=e.data.data,V.value=t}catch(e){y.error(e.response.data.message)}finally{r.value=!1}},W=async()=>{r.value=!0;try{const e=await I.get(x("invoices.count-by-status"));s.value=e.data.data}catch(e){y.error(e.response.data.message)}finally{r.value=!1}},X=async e=>{r.value=!0;try{const t=await I.get(x("invoices.index"),{params:{...U}});w.value=t.data.data}catch(t){y.error(t.response.data.message)}finally{r.value=!1}},L=e=>e==="Paid"?{variant:"primary",icon:"tabler-circle-half-2"}:e==="Unpaid"?{variant:"warning",icon:"tabler-chart-pie"}:e==="Downloaded"?{variant:"info",icon:"tabler-arrow-down-circle"}:e==="Draft"?{variant:"primary",icon:"tabler-device-floppy"}:e==="Sent"?{variant:"secondary",icon:"tabler-circle-check"}:e==="Overdue"?{variant:"error",icon:"tabler-alert-circle"}:{variant:"secondary",icon:"tabler-x"},u=ue.debounce(()=>{g()},500);return te(M,()=>{u()}),te([C,_,U],()=>{g()}),{invoiceData:$,isLoading:r,errors:T,getInvoice:E,invoiceId:Q,sortBy:j,itemsPerPage:_,totalPages:P,filters:U,paginationData:G,respResult:b,fetchInvoicesByStatus:W,invoices:w,invoicesByStatus:s,fetchInvoices:g,deleteInvoice:q,refetchData:H,updateInvoice:B,currentPage:C,searchQuery:M,refListTable:k,totalRecords:V,headers:z,isSortDirDesc:A,perPageOptions:O,storeInvoice:K,fetchInvoicesList:X,resolveInvoiceStatusVariantAndIcon:L,updateInvoiceStatus:J}}const S=r=>(De("data-v-b1a39f9c"),r=r(),we(),r),Fe=S(()=>d("h3",null," Create New Estimate ",-1)),Pe={key:0,class:"scrollable-table"},Ae=S(()=>d("h3",{class:"font-weight-medium mb-3"}," Customer Details: ",-1)),Te=S(()=>d("td",{class:"pe-6"}," Name: ",-1)),Ee={class:"font-weight-semibold"},Be=S(()=>d("td",{class:"pe-6"}," Phone: ",-1)),Le=S(()=>d("td",{class:"pe-6"}," Address: ",-1)),Ne=S(()=>d("td",{class:"pe-6"}," Lead Type: ",-1)),Re={class:"d-flex gap-2"},Me={style:{width:"120px"}},je={style:{width:"160px"}},qe={class:"my-2"},Ye=S(()=>d("span",{class:"d-inline"},"Item Total: ",-1)),ze={class:"text-body-1"},Oe={class:"mt-4 ma-sm-2"},Qe={class:"mb-2"},Ge={__name:"Add",props:{isDialogVisible:{type:Boolean,required:!0},estimateId:{type:Number,required:!1}},emits:["refetchData","update:isDialogVisible"],setup(r,{emit:b}){const k=r,z=["Bank Account","Stripe","Paypal","Cash","Check"],U=["Draft","Unpaid","Paid","Overdue","Cancelled","Refunded"],w={completion_date:"",due_date:"",note:"",customer_id:"",estimate_id:"",payment_method:"",payment_status:"Draft",sub_total:0,tax_amount:0,total:0,items:[{id:1,type:"",location:"",service:"",description:"",price:0,discount:0,total:0,discount_type:"fixed"}]},s=c({...w}),_=c({}),V=c(!1),{getCustomer:C,customerData:P}=xe(),{storeInvoice:O,errors:M,respResult:j,isLoading:A}=$e(),{getEstimate:Q,estimateData:$,fetchEstimatesList:T,estimates:G,isLoading:H}=ke(),q=async u=>{await Q(u),await C($.value.customer_id),_.value=P.value,s.value.customer_id=P.value.id,s.value.estimate_id=$.value.id,s.value.items=[],$.value.items.forEach(e=>{s.value.items.push({id:s.value.items.length+1,type:e.type,location:e.location,service:e.service,description:e.description,price:e.price,discount:e.discount,total:e.total,discount_type:e.discount_type})}),E()};ye(async()=>{k.isDialogVisible&&(await T(),k.estimateId&&await q(k.estimateId))});const E=()=>{s.value.sub_total=0,s.value.total=0,s.value.items.forEach(u=>{s.value.sub_total+=parseFloat(u.total),s.value.total+=parseFloat(u.total)})},B=u=>{const e=s.value.items[u],{price:t,discount:i}=e;e.discount_type==="percentage"?e.total=parseFloat(t)-parseFloat(t)*parseFloat(i)/100:e.total=parseFloat(t)-parseFloat(i),E()},J=()=>{s.value.items.push({id:s.value.items.length+1,type:"",location:"",service:"",description:"",price:0,discount:0,total:0,discount_type:"fixed"})},K=u=>{s.value.items.splice(u,1),E()},g=c(),W=()=>{s.value={...w},Ie(()=>{var u,e;(u=g.value)==null||u.reset(),(e=g.value)==null||e.resetValidation()})},X=async()=>{var u;(u=g.value)==null||u.validate().then(async({valid:e})=>{if(e){const t=new FormData;t.append("completion_date",s.value.completion_date),t.append("due_date",s.value.due_date),t.append("estimate_id",s.value.estimate_id),t.append("payment_method",s.value.payment_method),t.append("payment_status",s.value.payment_status),t.append("customer_id",s.value.customer_id),t.append("sub_total",s.value.sub_total),t.append("tax_amount",s.value.tax_amount),t.append("total",s.value.total),s.value.note&&t.append("note",s.value.note);const i=s.value.items;for(let m=0;m<i.length;m++){const f=i[m];t.append(`items[${m}][type]`,f.type),t.append(`items[${m}][location]`,f.location),t.append(`items[${m}][service]`,f.service),t.append(`items[${m}][description]`,f.description),t.append(`items[${m}][price]`,f.price),t.append(`items[${m}][discount]`,f.discount),t.append(`items[${m}][discount_type]`,f.discount_type),t.append(`items[${m}][total]`,f.total)}try{await O(t),j.value.status===200&&(b("refetchData"),b("update:isDialogVisible",!1),W())}catch(m){console.log(m)}}})},L=u=>{b("update:isDialogVisible",u)};return(u,e)=>{const t=ce,i=pe,m=me,f=re;return N(),Y(le,null,[a(Ue,{width:u.$vuetify.display.smAndDown?"auto":"90%","model-value":k.isDialogVisible,persistent:"","onUpdate:modelValue":L},{default:n(()=>[a(t,{onClick:e[0]||(e[0]=o=>L(!1))}),a(ne,{title:"Create Invoice"},{default:n(()=>[a(ie,null,{default:n(()=>[a(Se,{ref_key:"refForm",ref:g,onSubmit:be(X,["prevent"])},{default:n(()=>[a(de,null,{default:n(()=>[a(p,{cols:"12",md:"6"},{default:n(()=>[a(i,{modelValue:l(s).completion_date,"onUpdate:modelValue":e[1]||(e[1]=o=>l(s).completion_date=o),rules:[l(D)],density:"compact",label:"Select Completion Date",config:{altInput:!0,altFormat:"F j, Y",dateFormat:"Y-m-d",disableMobile:!0}},null,8,["modelValue","rules"])]),_:1}),a(p,{cols:"12",md:"6"},{default:n(()=>[a(i,{modelValue:l(s).due_date,"onUpdate:modelValue":e[2]||(e[2]=o=>l(s).due_date=o),rules:[l(D)],density:"compact",label:"Select Due Date",config:{altInput:!0,altFormat:"F j, Y",dateFormat:"Y-m-d",disableMobile:!0}},null,8,["modelValue","rules"])]),_:1}),a(p,{cols:"12",md:"4"},{default:n(()=>[a(m,{modelValue:l(s).estimate_id,"onUpdate:modelValue":[e[3]||(e[3]=o=>l(s).estimate_id=o),q],items:l(G),"item-title":"label","item-value":"id",label:"Select Estimate",class:"mb-6",density:"compact",loading:l(H),rules:[l(D)]},null,8,["modelValue","items","loading","rules"])]),_:1}),a(p,{cols:"12",md:"4"},{default:n(()=>[Fe,a(R,{onClick:e[4]||(e[4]=o=>V.value=!0)},{default:n(()=>[a(ae,{size:"20",icon:"tabler-plus"})]),_:1})]),_:1}),a(p,{cols:"12",md:"12"},{default:n(()=>[l(_).name?(N(),Y("div",Pe,[Ae,d("table",null,[d("tbody",null,[d("tr",null,[Te,d("td",Ee,F(l(_).name),1)]),d("tr",null,[Be,d("td",null,F(l(_).phone),1)]),d("tr",null,[Le,d("td",null,F(l(_).address),1)]),d("tr",null,[Ne,d("td",null,F(l(_).lead_type),1)])])])])):se("",!0)]),_:1}),a(p,{cols:"12"},{default:n(()=>[(N(!0),Y(le,null,Ve(l(s).items,(o,h)=>(N(),Y("div",{key:h,class:"ma-sm-2 mb-2 border px-2 py-2 rounded-md"},[a(ne,{flat:""},{default:n(()=>[a(de,null,{default:n(()=>[a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[a(f,{modelValue:o.type,"onUpdate:modelValue":v=>o.type=v,rules:[l(D)],label:"Type"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[a(f,{modelValue:o.location,"onUpdate:modelValue":v=>o.location=v,rules:[l(D)],label:"Location"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[a(f,{modelValue:o.service,"onUpdate:modelValue":v=>o.service=v,rules:[l(D)],label:"Service"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[a(ee,{modelValue:o.description,"onUpdate:modelValue":v=>o.description=v,rows:"2",label:"Description",placeholder:"Description"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[a(f,{modelValue:o.price,"onUpdate:modelValue":[v=>o.price=v,v=>B(h)],rules:[l(D)],type:"number",min:"0",label:"Price"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[d("div",Re,[d("div",Me,[a(f,{modelValue:o.discount,"onUpdate:modelValue":[v=>o.discount=v,v=>B(h)],type:"number",min:"0",label:"Discount"},null,8,["modelValue","onUpdate:modelValue"])]),d("div",je,[a(m,{modelValue:o.discount_type,"onUpdate:modelValue":[v=>o.discount_type=v,v=>B(h)],items:[{value:"fixed",title:"Fixed"},{value:"percentage",title:"Percentage"}],label:"Discount Type",dense:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024),a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[d("h3",qe,[Ye,d("span",ze,F(l(oe)(o.total)),1)])]),_:2},1024),a(p,{sm:"12",cols:"12",md:"3"},{default:n(()=>[a(R,{icon:"",size:"x-small",color:"error",disabled:h===0,onClick:v=>K(h)},{default:n(()=>[a(ae,{size:"20",icon:"tabler-x"})]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),d("div",Oe,[a(R,{onClick:J},{default:n(()=>[Z(" Add Item ")]),_:1})])]),_:1}),a(p,{cols:"12",md:"6"},{default:n(()=>[a(m,{modelValue:l(s).payment_method,"onUpdate:modelValue":e[5]||(e[5]=o=>l(s).payment_method=o),items:z,label:"Payment Method",class:"mb-2",density:"compact",rules:[l(D)]},null,8,["modelValue","rules"])]),_:1}),a(p,{cols:"12",md:"6"},{default:n(()=>[a(m,{modelValue:l(s).payment_status,"onUpdate:modelValue":e[6]||(e[6]=o=>l(s).payment_status=o),items:U,label:"Payment Status",class:"mb-2",density:"compact",rules:[l(D)]},null,8,["modelValue","rules"])]),_:1}),a(ie,{class:"d-flex justify-end flex-wrap flex-column flex-sm-row"},{default:n(()=>[d("h2",Qe," Total: "+F(l(oe)(l(s).sub_total)),1)]),_:1}),a(p,{cols:"12",md:"12"},{default:n(()=>[a(ee,{modelValue:l(s).note,"onUpdate:modelValue":e[7]||(e[7]=o=>l(s).note=o),clearable:"","clear-icon":"tabler-circle-x",label:"Notes"},null,8,["modelValue"])]),_:1}),a(p,{cols:"12",class:"d-flex flex-wrap gap-4 justify-end"},{default:n(()=>[a(R,{type:"submit",loading:l(A),disabled:l(A),onClick:e[8]||(e[8]=o=>{var h;return(h=l(g))==null?void 0:h.validate()})},{default:n(()=>[Z(" Create Invoice ")]),_:1},8,["loading","disabled"]),a(R,{color:"secondary",variant:"tonal",onClick:e[9]||(e[9]=o=>L(!1))},{default:n(()=>[Z(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"]),l(V)?(N(),ge(Ce,{key:0,isDialogVisible:l(V),"onUpdate:isDialogVisible":e[10]||(e[10]=o=>he(V)?V.value=o:null),onRefetchData:l(T)},null,8,["isDialogVisible","onRefetchData"])):se("",!0)],64)}}},it=_e(Ge,[["__scopeId","data-v-b1a39f9c"]]);export{it as A,$e as u};
