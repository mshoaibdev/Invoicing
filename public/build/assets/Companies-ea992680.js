import{aB as u,am as G,at as m,n as h,bk as o,y as a,bu as O,bt as L,bp as Q,q as d,b0 as e,by as W,o as C,p as I,bx as D,cf as F,cp as X,x as v,cq as Y,cr as U,ac as Z,ab as ee,aU as R,cs as ae,F as M,aE as te,ct as T,cu as q,cv as oe,a5 as le}from"./main-70b82271.js";import{_ as se}from"./DialogCloseBtn-478619bf.js";import{u as ne}from"./companies-1f6498bb.js";import{V as re,r as N}from"./validators-f8585958.js";import{a as ie,V as k}from"./VRow-498fad85.js";import{V as E}from"./VAutocomplete-c6b44a42.js";import"./index-628b2924.js";import"./filter-73280f75.js";import"./VCheckboxBtn-d416ecdf.js";import"./VSelectionControl-f8a2bfe4.js";const de={key:1,class:"d-flex justify-center gap-2 align-center"},ce={key:2,class:""},ue=d("p",{class:"text-body-2 mb-0"}," Allowed JPG, GIF or PNG. Max size of 10MB ",-1),me=d("span",{class:"d-none d-sm-block"}," Upload new logo ",-1),pe=d("div",{class:"d-flex flex-column justify-center gap-2 align-center"},null,-1),fe=d("label",{class:"text-body-1"},[v("Company Name "),d("span",{class:"color-red"},"*")],-1),ge=d("label",{class:"text-body-1"},[v("Select Country "),d("span",{class:"color-red"},"*")],-1),ye=d("label",{class:"text-body-1"},[v("Select Currency "),d("span",{class:"color-red"},"*")],-1),_e={__name:"AddCompany",props:{isDialogVisible:{type:Boolean,required:!0}},emits:["refetchData","update:isDialogVisible"],setup(j,{emit:p}){const w=j,{storeCompany:b,errors:S,respResult:$,isLoading:y}=ne(),_=u(),n=u(),f=u(""),c={name:"",currency_id:1,country_id:231,logo:""},g=u([]),V=u([]),A=async()=>{try{const l=await U.get("/countries");g.value=l.data.data}catch(l){console.log(l)}},P=async()=>{try{const l=await U.get("/currencies");V.value=l.data.data}catch(l){console.log(l)}},s=u({...c});G(async()=>{w.isDialogVisible&&(await A(),await P())});const z=()=>{s.value={...c},Z(()=>{var l,t;(l=_.value)==null||l.reset(),(t=_.value)==null||t.resetValidation()})},J=async()=>{var l;(l=_.value)==null||l.validate().then(async({valid:t})=>{if(t){const r=new FormData;r.append("name",s.value.name),r.append("address[country_id]",s.value.country_id),r.append("currency_id",s.value.currency_id),s.value.logo&&r.append("logo",s.value.logo),await b(r),$.value.status===200&&(p("refetchData"),p("update:isDialogVisible",!1),z())}})},H=l=>{const t=new FileReader,{files:r}=l.target;r&&r.length&&(t.readAsDataURL(r[0]),t.onload=()=>{s.value.logo=r[0],typeof t.result=="string"&&(f.value=t.result)})},K=()=>{s.value.logo="",f.value=""},B=l=>{p("update:isDialogVisible",l)};return(l,t)=>{const r=se;return m(),h(Y,{width:l.$vuetify.display.smAndDown?"auto":600,"model-value":w.isDialogVisible,"onUpdate:modelValue":B},{default:o(()=>[a(r,{onClick:t[0]||(t[0]=i=>B(!1))}),a(O,{title:"Add New Company"},{default:o(()=>[a(L,null,{default:o(()=>[a(re,{ref_key:"refForm",ref:_,onSubmit:Q(J,["prevent"])},{default:o(()=>[a(ie,null,{default:o(()=>[a(k,{cols:"12",md:"12"},{default:o(()=>[a(L,{class:"d-flex justify-center",style:{border:"1px dashed #ccc",padding:"10px","text-align":"center"}},{default:o(()=>[d("div",null,[e(f)?(m(),h(W,{key:0,rounded:"",border:"",class:"bg-white border","aspect-ratio":1,height:"100",src:e(f)},null,8,["src"])):C("",!0),e(s).logo?(m(),I("div",de,[a(D,{color:"error",variant:"text",class:"remove-logo-btn",icon:"tabler-trash",onClick:K})])):C("",!0),e(s).logo?C("",!0):(m(),I("div",ce,[ue,a(D,{color:"primary",variant:"text",onClick:t[1]||(t[1]=i=>{var x;return(x=e(n))==null?void 0:x.click()})},{default:o(()=>[a(F,{icon:"tabler-cloud-upload",class:"d-sm-none"}),me]),_:1}),d("input",{ref_key:"refInputEl",ref:n,type:"file",accept:".jpeg,.png,.jpg,GIF",hidden:"",onInput:H},null,544)]))]),pe]),_:1})]),_:1}),a(k,{cols:"12",md:"12"},{default:o(()=>[fe,a(X,{modelValue:e(s).name,"onUpdate:modelValue":t[2]||(t[2]=i=>e(s).name=i),rules:[e(N)]},null,8,["modelValue","rules"])]),_:1}),a(k,{cols:"12",md:"12"},{default:o(()=>[ge,a(E,{modelValue:e(s).country_id,"onUpdate:modelValue":t[3]||(t[3]=i=>e(s).country_id=i),rules:[e(N)],items:e(g),"item-title":"name","item-value":"id",loading:e(y)},null,8,["modelValue","rules","items","loading"])]),_:1}),a(k,{cols:"12",md:"12"},{default:o(()=>[ye,a(E,{modelValue:e(s).currency_id,"onUpdate:modelValue":t[4]||(t[4]=i=>e(s).currency_id=i),rules:[e(N)],items:e(V),"item-title":i=>`${i.code} - ${i.name} `,"item-value":"id",loading:e(y)},null,8,["modelValue","rules","items","item-title","loading"])]),_:1}),a(k,{cols:"12",class:"d-flex flex-wrap gap-4 justify-end"},{default:o(()=>[a(D,{type:"submit",loading:e(y),disabled:e(y),onClick:t[5]||(t[5]=i=>{var x;return(x=e(_))==null?void 0:x.validate()})},{default:o(()=>[v(" Save "),a(F,{icon:"tabler-download",class:"ms-2"})]),_:1},8,["loading","disabled"]),a(D,{color:"secondary",variant:"tonal",onClick:t[6]||(t[6]=i=>B(!1))},{default:o(()=>[v(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}},ve=["src"],Ae={__name:"Companies",setup(j){const p=u(!1),w=u([]),b=u({}),S=u(!1),$=async()=>{try{const n=await U.get("/bootstrap");w.value=n.data.companies,S.value=n.data.is_allowed_to_create_company,y(n.data.current_company)}catch(n){console.log(n)}},y=n=>{n&&(localStorage.setItem("companyId",n.id),b.value=n)},_=n=>{y(n),window.location.reload()};return G(async()=>{await $()}),(n,f)=>(m(),I(M,null,[a(oe,null,{activator:o(({props:c})=>[a(D,ee({color:"primary",variant:"text"},c),{default:o(()=>{var g,V,A;return[(g=e(b))!=null&&g.logo_url?(m(),I("img",{key:0,src:((V=e(b))==null?void 0:V.logo_url)??"",alt:"company logo",height:"24"},null,8,ve)):C("",!0),d("span",null,R(((A=e(b))==null?void 0:A.name)??"Select Company"),1),a(F,{size:"18",icon:"tabler-chevron-down"})]}),_:2},1040)]),default:o(()=>[a(ae,null,{default:o(()=>[(m(!0),I(M,null,te(e(w),(c,g)=>(m(),h(q,{key:g,value:g,onClick:V=>_(c)},{default:o(()=>[a(T,null,{default:o(()=>[v(R(c.name),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128)),e(S)?(m(),h(q,{key:0,onClick:f[0]||(f[0]=c=>p.value=!0)},{prepend:o(()=>[a(F,{class:"me-2",icon:"tabler-plus",size:"22"})]),default:o(()=>[a(T,null,{default:o(()=>[v("Add New Company")]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1}),e(p)?(m(),h(_e,{key:0,isDialogVisible:e(p),"onUpdate:isDialogVisible":f[1]||(f[1]=c=>le(p)?p.value=c:null),onRefetchData:$},null,8,["isDialogVisible"])):C("",!0)],64))}};export{Ae as default};
