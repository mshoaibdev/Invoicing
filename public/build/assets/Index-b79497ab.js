import{V as fe,_ as _e}from"./VDataTableServer-84efd4e3.js";import{_ as de}from"./AppTextField-9867e25c.js";import{V as oe,_ as ue,u as ve,d as ne,c as re,a as Ve}from"./VTextarea-bfeb20e3.js";import{c as se,u as be,l as ge,_ as ye,b as De}from"./Add-bc5c5574.js";import{f as Q}from"./formatters-12413ec5.js";import{V as ee,d as he,a as ae}from"./VCard-a375baf5.js";import{a as te,V as c}from"./VRow-db2c24e9.js";import{o as ie,a as _,c as h,w as s,b as t,u as e,d as l,t as m,f as W,F as me,p as ce,V as B,g as J,h as k,r as b,a6 as $e,E as z,U as D,af as xe,e as Ce}from"./main-c40ee4ed.js";import{V as pe}from"./VDialog-fe67dd57.js";import{_ as we}from"./AppDateTimePicker-4011cefb.js";import{V as ke,r as F}from"./VForm-48297921.js";import{A as Ue}from"./Add-38c6b271.js";import{V as Ee}from"./VDivider-e4e61359.js";import"./VCheckboxBtn-609a0dc2.js";import"./VSelectionControl-84b50376.js";import"./VInput-135e03cb.js";import"./transition-127812ba.js";import"./VTextField-1b1d5e52.js";import"./forwardRefs-9d31fcaa.js";import"./VImg-3d39c17f.js";import"./VList-4b19a862.js";import"./VAvatar-1c4c29a7.js";import"./VMenu-ebdbfbe8.js";import"./VOverlay-93ac4317.js";import"./axios-da837377.js";import"./parse-263515be.js";import"./index.m-120058be.js";import"./_commonjsHelpers-725317a4.js";const Ie=l("p",{class:"text-sm text-uppercase text-disabled"}," Estimate Details ",-1),Te=l("th",null," Customer Name: ",-1),Se=l("th",null," Email: ",-1),Fe=["href"],Ae=l("th",null," Phone: ",-1),Ne=["href"],Le=l("th",null," Address: ",-1),Pe=l("th",null," Expiry Date: ",-1),Be=l("th",null," Estimate Date: ",-1),Re=l("th",null," Notes: ",-1),qe=l("p",{class:"text-sm text-uppercase text-disabled"}," Estimate Items ",-1),Me=l("thead",null,[l("tr",null,[l("th",null,"Type"),l("th",null,"Location"),l("th",null,"Service"),l("th",null,"Description"),l("th",null,"Price"),l("th",null,"Discount"),l("th",null,"Total")])],-1),je={__name:"View",props:{isDialogVisible:{type:Boolean,required:!0},estimateId:{type:Number,required:!0}},emits:["update:isDialogVisible","createInvoice"],setup(j,{emit:$}){const g=j,{getEstimate:U,estimateData:f,sendEstimate:E,isLoading:R}=se(),I=async()=>{await E(g.estimateId)},G=()=>{$("createInvoice")};ie(async()=>{g.isDialogVisible&&await U(g.estimateId)});const A=x=>{$("update:isDialogVisible",x)};return(x,H)=>{const O=ue;return _(),h(pe,{width:x.$vuetify.display.smAndDown?600:"60%","model-value":j.isDialogVisible,"onUpdate:modelValue":A},{default:s(()=>[t(O,{onClick:H[0]||(H[0]=V=>A(!1))}),e(f).customer?(_(),h(ee,{key:0},{default:s(()=>[t(te,null,{default:s(()=>[t(c,{cols:"12",lg:"6",md:"6",sm:"6"},{default:s(()=>[Ie,t(oe,null,{default:s(()=>[l("tbody",null,[l("tr",null,[Te,l("td",null,m(e(f).customer.name),1)]),l("tr",null,[Se,l("td",null,[l("a",{href:`mailto:${e(f).customer.email}`},m(e(f).customer.email),9,Fe)])]),l("tr",null,[Ae,l("td",null,[l("a",{href:`tel:${e(f).customer.phone}`},m(e(f).customer.phone),9,Ne)])]),l("tr",null,[Le,l("td",null,m(e(f).customer.address),1)]),l("tr",null,[Pe,l("td",null,m(e(f).expiry_date),1)]),l("tr",null,[Be,l("td",null,m(e(f).estimate_date),1)]),l("tr",null,[Re,l("td",null,m(e(f).notes),1)])])]),_:1})]),_:1}),t(c,{cols:"12",lg:"6",md:"6",sm:"6"},{default:s(()=>[qe,t(oe,null,{default:s(()=>[Me,l("tbody",null,[(_(!0),W(me,null,ce(e(f).items,(V,T)=>(_(),W("tr",{key:T},[l("td",null,m(V.type),1),l("td",null,m(V.location),1),l("td",null,m(V.service),1),l("td",null,m(V.description),1),l("td",null,m(e(Q)(V.price)),1),l("td",null,m(V.discount),1),l("td",null,m(e(Q)(V.total)),1)]))),128))])]),_:1})]),_:1})]),_:1}),t(he,{class:"d-flex justify-center"},{default:s(()=>[t(B,{color:"primary",variant:"outlined",loading:e(R),onClick:I},{default:s(()=>[J(" Send Estimate ")]),_:1},8,["loading"]),t(B,{color:"primary",variant:"outlined",onClick:G},{default:s(()=>[J(" Create Invoice ")]),_:1})]),_:1})]),_:1})):k("",!0)]),_:1},8,["width","model-value"])}}},He=l("h3",null," Create New Customer ",-1),Oe={class:"d-flex gap-2"},Ye={style:{width:"120px"}},ze={style:{width:"160px"}},Je={class:"my-2"},Qe=l("span",{class:"d-inline"},"Item Total: ",-1),We={class:"text-body-1"},Ge=l("div",{class:"d-flex flex-column justify-space-between pa-1"},null,-1),Ke={class:"mt-4 ma-sm-2"},Xe={class:"mb-2"},Ze={__name:"Edit",props:{isDialogVisible:{type:Boolean,required:!0},estimateId:{type:Number,required:!0}},emits:["refetchData","update:isDialogVisible"],setup(j,{emit:$}){const g=j,U=b(!1),{fetchCustomersList:f,customers:E,isLoading:R}=be(),{updateEstimate:I,errors:G,respResult:A,isLoading:x,getEstimate:H,estimateData:O}=se(),{users:V,fetchUsersList:T,filters:S,isLoading:q}=ve();ie(async()=>{g.isDialogVisible&&(await H(g.estimateId),i.value={...O.value,items:O.value.items.map(r=>({...r,total:r.total,price:r.price,quantity:r.quantity}))},S.role="SalesMan",await f(),await T(),K.value=E.value.find(r=>r.id===O.value.customer_id))});const N={title:"",estimate_date:"",expiry_date:"",salesman_id:"",notes:"",customer_id:"",sub_total:0,tax_amount:0,total:0,items:[{id:1,type:"",location:"",service:"",description:"",price:0,discount:0,total:0,discount_type:"fixed"}]},i=b({...N}),K=b({}),C=()=>{i.value.sub_total=0,i.value.total=0,i.value.items.forEach(r=>{i.value.sub_total+=parseFloat(r.total),i.value.total+=parseFloat(r.total)})},Y=r=>{const u=i.value.items[r],{price:o,discount:n}=u;u.discount_type==="percentage"?u.total=parseFloat(o)-parseFloat(o)*parseFloat(n)/100:u.total=parseFloat(o)-parseFloat(n),u.total=parseFloat(o)-parseFloat(n),C()},w=()=>{i.value.items.push({id:i.value.items.length+1,type:"",location:"",service:"",description:"",price:0,discount:0,total:0,discount_type:"fixed"})},X=r=>{i.value.items.splice(r,1),C()},M=b(),le=()=>{i.value={...N},xe(()=>{var r,u;(r=M.value)==null||r.reset(),(u=M.value)==null||u.resetValidation()})},Z=async()=>{var r;(r=M.value)==null||r.validate().then(async({valid:u})=>{if(u){const o=new FormData;o.append("title",i.value.title),o.append("estimate_date",i.value.estimate_date),o.append("expiry_date",i.value.expiry_date),o.append("customer_id",i.value.customer_id),o.append("salesman_id",i.value.salesman_id),o.append("sub_total",i.value.sub_total),o.append("tax_amount",i.value.tax_amount),o.append("total",i.value.total),i.value.notes&&o.append("notes",i.value.notes);const n=i.value.items;for(let p=0;p<n.length;p++){const v=n[p];o.append(`items[${p}][type]`,v.type),o.append(`items[${p}][location]`,v.location),o.append(`items[${p}][service]`,v.service),o.append(`items[${p}][description]`,v.description),o.append(`items[${p}][price]`,v.price),o.append(`items[${p}][discount]`,v.discount),o.append(`items[${p}][discount_type]`,v.discount_type),o.append(`items[${p}][total]`,v.total)}o.append("_method","PUT");try{await I(g.estimateId,o),A.value.status===200&&($("refetchData"),$("update:isDialogVisible",!1),le())}catch(p){console.log(p)}}})},L=r=>{$("update:isDialogVisible",r)};return(r,u)=>{const o=ue,n=de,p=we,v=re;return _(),h(pe,{width:r.$vuetify.display.smAndDown?"auto":"90%","model-value":g.isDialogVisible,persistent:"","onUpdate:modelValue":L},{default:s(()=>[t(o,{onClick:u[0]||(u[0]=d=>L(!1))}),t(ee,{title:"Update Estimate"},{default:s(()=>[t(ae,null,{default:s(()=>[t(ke,{ref_key:"refForm",ref:M,onSubmit:$e(Z,["prevent"])},{default:s(()=>[t(te,null,{default:s(()=>[t(c,{cols:"12",md:"6"},{default:s(()=>[t(n,{modelValue:e(i).title,"onUpdate:modelValue":u[1]||(u[1]=d=>e(i).title=d),rules:[e(F)],label:"Estimate Title",dense:""},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12",md:"6"},{default:s(()=>[t(p,{modelValue:e(i).estimate_date,"onUpdate:modelValue":u[2]||(u[2]=d=>e(i).estimate_date=d),rules:[e(F)],density:"compact",label:"Select Estimate Date",config:{altInput:!0,enableTime:!0,altFormat:"Y-m-d H:i",dateFormat:"Y-m-dTH:i",disableMobile:!0,closeOnSelect:!0}},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12",md:"6"},{default:s(()=>[t(p,{modelValue:e(i).expiry_date,"onUpdate:modelValue":u[3]||(u[3]=d=>e(i).expiry_date=d),rules:[e(F)],density:"compact",label:"Select Expire Date",config:{altInput:!0,enableTime:!0,altFormat:"Y-m-d H:i",dateFormat:"Y-m-dTH:i",disableMobile:!0,closeOnSelect:!0}},null,8,["modelValue","rules"])]),_:1}),t(c,{cols:"12",md:"4"},{default:s(()=>[t(v,{modelValue:e(i).customer_id,"onUpdate:modelValue":u[4]||(u[4]=d=>e(i).customer_id=d),items:e(E),"item-title":"name","item-value":"id",label:"Select customer",class:"mb-6",density:"compact",loading:e(R),rules:[e(F)]},null,8,["modelValue","items","loading","rules"])]),_:1}),t(c,{cols:"12",md:"2"},{default:s(()=>[He,t(B,{onClick:u[5]||(u[5]=d=>U.value=!0)},{default:s(()=>[t(z,{size:"20",icon:"tabler-plus"})]),_:1})]),_:1}),t(c,{cols:"12",md:"6"},{default:s(()=>[t(v,{modelValue:e(i).salesman_id,"onUpdate:modelValue":u[6]||(u[6]=d=>e(i).salesman_id=d),items:e(V),"item-title":"name","item-value":"id",label:"Select salesman",class:"mb-6",density:"compact",loading:e(q),rules:[e(F)]},null,8,["modelValue","items","loading","rules"])]),_:1}),t(c,{cols:"12"},{default:s(()=>[(_(!0),W(me,null,ce(e(i).items,(d,y)=>(_(),W("div",{key:y,class:"ma-sm-2 mb-2 border px-2 py-2 rounded-md"},[t(ee,{flat:""},{default:s(()=>[t(te,null,{default:s(()=>[t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[t(v,{modelValue:d.type,"onUpdate:modelValue":a=>d.type=a,label:"Estimate Type",rules:[e(F)],"item-title":"name","item-value":"id",items:e(ge)},null,8,["modelValue","onUpdate:modelValue","rules","items"])]),_:2},1024),t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[t(n,{modelValue:d.location,"onUpdate:modelValue":a=>d.location=a,rules:[e(F)],label:"Location"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[t(n,{modelValue:d.service,"onUpdate:modelValue":a=>d.service=a,rules:[e(F)],label:"Service"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[t(ne,{modelValue:d.description,"onUpdate:modelValue":a=>d.description=a,rows:"2",label:"Description",placeholder:"Description"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[t(n,{modelValue:d.price,"onUpdate:modelValue":[a=>d.price=a,a=>Y(y)],rules:[e(F)],type:"number",min:"0",label:"Price"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[l("div",Oe,[l("div",Ye,[t(n,{modelValue:d.discount,"onUpdate:modelValue":[a=>d.discount=a,a=>Y(y)],type:"number",min:"0",label:"Discount"},null,8,["modelValue","onUpdate:modelValue"])]),l("div",ze,[t(v,{modelValue:d.discount_type,"onUpdate:modelValue":[a=>d.discount_type=a,a=>Y(y)],items:[{value:"fixed",title:"Fixed"},{value:"percentage",title:"Percentage"}],label:"Discount Type",dense:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024),t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[l("h4",Je,[Qe,l("span",We,m(e(Q)(d.total)),1)])]),_:2},1024),t(c,{sm:"12",cols:"12",md:"3"},{default:s(()=>[t(B,{icon:"",size:"x-small",color:"error",disabled:y===0,onClick:a=>X(y)},{default:s(()=>[t(z,{size:"20",icon:"tabler-x"})]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024),Ge]),_:2},1024)]))),128)),l("div",Ke,[t(B,{onClick:w},{default:s(()=>[J(" Add Item ")]),_:1})])]),_:1}),t(ae,{class:"d-flex justify-end flex-wrap flex-column flex-sm-row"},{default:s(()=>[l("h2",Xe," Total: "+m(e(Q)(e(i).sub_total)),1)]),_:1}),t(c,{cols:"12",md:"12"},{default:s(()=>[t(ne,{modelValue:e(i).notes,"onUpdate:modelValue":u[7]||(u[7]=d=>e(i).notes=d),clearable:"","clear-icon":"tabler-circle-x",label:"Notes"},null,8,["modelValue"])]),_:1}),t(c,{cols:"12",class:"d-flex flex-wrap gap-4 justify-end"},{default:s(()=>[t(B,{type:"submit",loading:e(x),disabled:e(x),onClick:u[8]||(u[8]=d=>{var y;return(y=e(M))==null?void 0:y.validate()})},{default:s(()=>[J(" Create Estimate ")]),_:1},8,["loading","disabled"]),t(B,{color:"secondary",variant:"tonal",onClick:u[9]||(u[9]=d=>L(!1))},{default:s(()=>[J(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1}),e(U)?(_(),h(ye,{key:0,isDialogVisible:e(U),"onUpdate:isDialogVisible":u[10]||(u[10]=d=>D(U)?U.value=d:null),onRefetchData:e(f)},null,8,["isDialogVisible","onRefetchData"])):k("",!0)]),_:1},8,["width","model-value"])}}};const et={class:"me-3 d-flex gap-3"},tt={key:1,class:"text-grey text-caption align-self-center"},lt=["href"],at={class:"d-flex align-center justify-space-between"},st=["onClick"],it=["href"],ot={class:"d-flex align-center"},nt={class:"me-3"},dt={class:"d-flex align-center"},ut=["onClick"],Bt={__name:"Index",props:{customerId:{type:Number,required:!1}},setup(j){const $=j,{estimates:g,totalRecords:U,isLoading:f,fetchEstimates:E,currentPage:R,headers:I,deleteEstimate:G,itemsPerPage:A,searchQuery:x,filters:H,paginationData:O}=se(),V=b([]),T=b(!1),S=b(!1),q=b(!1),N=b(!1),i=b(!1),K=b(!1),C=b(0),Y=b(0),w=b([]);ie(async()=>{$.customerId&&(Y.value=$.customerId,H.customerId=$.customerId),window.innerWidth<768&&(w.value=I.slice(0,2),K.value=!0),await E()});const X=()=>{const o=JSON.parse(localStorage.getItem("estimates.table"));o?w.value=o.filter(n=>n.visible===!0):w.value=I};X();const M=async o=>{I.forEach(n=>{n.visible=o.includes(n.title)}),localStorage.setItem("estimates.table",JSON.stringify(I)),X()},le=()=>{S.value=!1,N.value=!0},Z=o=>{C.value=o,T.value=!0},L=o=>{C.value=o,S.value=!0},r=o=>{i.value=!0,C.value=o},u=async o=>{if(o===!1){i.value=!1;return}await G(C.value),i.value=!1,S.value=!1,await E()};return(o,n)=>{const p=re,v=de,d=Ce("IconBtn"),y=_e;return e(g)?(_(),h(ee,{key:0,id:"invoice-list"},{default:s(()=>[t(ae,{class:"d-flex align-center flex-wrap gap-4"},{default:s(()=>[t(te,null,{default:s(()=>[t(c,{lg:"3",md:"3",cols:"12",sm:"4"},{default:s(()=>[l("div",et,[t(B,{"prepend-icon":"tabler-plus",onClick:n[0]||(n[0]=a=>q.value=!0)},{default:s(()=>[J(" Create Estimate ")]),_:1})])]),_:1}),t(c,{lg:"3",md:"6",sm:"8",cols:"12"},{default:s(()=>[t(p,{modelValue:e(w),"onUpdate:modelValue":[n[1]||(n[1]=a=>D(w)?w.value=a:null),M],label:"Select Column Visibility ",multiple:"",eager:"",items:e(I)},{selection:s(({item:a,index:P})=>[P<4?(_(),h(Ve,{key:0},{default:s(()=>[l("span",null,m(a.title),1)]),_:2},1024)):k("",!0),P===4?(_(),W("span",tt," (+"+m(e(w).length-4)+" others) ",1)):k("",!0)]),_:1},8,["modelValue","items"])]),_:1}),t(c,{lg:"3",md:"3",sm:"6",cols:"12"},{default:s(()=>[t(v,{modelValue:e(x),"onUpdate:modelValue":n[2]||(n[2]=a=>D(x)?x.value=a:null),label:"Search Estimates",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(Ee),t(e(fe),{modelValue:e(V),"onUpdate:modelValue":n[3]||(n[3]=a=>D(V)?V.value=a:null),"items-per-page":e(A),"onUpdate:itemsPerPage":n[4]||(n[4]=a=>D(A)?A.value=a:null),page:e(R),"onUpdate:page":n[5]||(n[5]=a=>D(R)?R.value=a:null),loading:e(f),"items-length":e(U),headers:e(w),items:e(g),class:"text-no-wrap"},{"item.customer.email":s(({item:a})=>[l("a",{href:`mailto:${a.raw.customer.email}`,class:"text-decoration-none"},m(a.raw.customer.email),9,lt)]),"item.customer.name":s(({item:a})=>[l("div",at,[l("a",{href:"javascript:;",onClick:P=>L(a.raw.id)},m(a.raw.customer.name),9,st),e(K)?(_(),h(d,{key:0,onClick:P=>L(a.raw.id)},{default:s(()=>[t(z,{icon:"tabler-eye"})]),_:2},1032,["onClick"])):k("",!0)])]),"item.customer.phone":s(({item:a})=>[l("a",{href:`tel:${a.raw.customer.phone}`,class:"text-decoration-none"},m(a.raw.customer.phone),9,it)]),"item.total":s(({item:a})=>[l("div",ot,[l("span",nt,m(e(Q)(a.raw.total)),1)])]),"item.title":s(({item:a})=>[l("div",dt,[l("a",{href:"javascript:;",onClick:P=>L(a.raw.id)},m(a.raw.title),9,ut)])]),"item.actions":s(({item:a})=>[t(d,{onClick:P=>r(a.raw.id)},{default:s(()=>[t(z,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),t(d,{onClick:P=>L(a.raw.id)},{default:s(()=>[t(z,{icon:"tabler-eye"})]),_:2},1032,["onClick"]),t(d,{onClick:P=>Z(a.raw.id)},{default:s(()=>[t(z,{icon:"tabler-pencil"})]),_:2},1032,["onClick"])]),_:1},8,["modelValue","items-per-page","page","loading","items-length","headers","items"]),e(S)?(_(),h(je,{key:0,isDialogVisible:e(S),"onUpdate:isDialogVisible":n[6]||(n[6]=a=>D(S)?S.value=a:null),"estimate-id":e(C),onEditEstimate:Z,onDeleteEstimate:r,onCreateInvoice:le},null,8,["isDialogVisible","estimate-id"])):k("",!0),e(q)?(_(),h(De,{key:1,isDialogVisible:e(q),"onUpdate:isDialogVisible":n[7]||(n[7]=a=>D(q)?q.value=a:null),"customer-id":e(Y),onRefetchData:e(E)},null,8,["isDialogVisible","customer-id","onRefetchData"])):k("",!0),e(N)?(_(),h(Ue,{key:2,isDialogVisible:e(N),"onUpdate:isDialogVisible":n[8]||(n[8]=a=>D(N)?N.value=a:null),"estimate-id":e(C)},null,8,["isDialogVisible","estimate-id"])):k("",!0),e(T)?(_(),h(Ze,{key:3,isDialogVisible:e(T),"onUpdate:isDialogVisible":n[9]||(n[9]=a=>D(T)?T.value=a:null),"estimate-id":e(C),onRefetchData:e(E)},null,8,["isDialogVisible","estimate-id","onRefetchData"])):k("",!0),t(y,{isDialogVisible:e(i),"onUpdate:isDialogVisible":n[10]||(n[10]=a=>D(i)?i.value=a:null),"cancel-title":"Cancelled","confirm-title":"Deleted","confirm-msg":"Estimate deleted successfully.","confirmation-question":"Are you sure you want to delete this estimate? This action cannot be undone.","cancel-msg":"Estimate deletion cancelled.",onConfirm:u},null,8,["isDialogVisible"])]),_:1})):k("",!0)}}};export{Bt as default};
