import{V as ve,_ as fe}from"./VDataTableServer-84efd4e3.js";import{_ as de}from"./AppTextField-9867e25c.js";import{V as ie,_ as ue,d as ne,c as me,a as Ve}from"./VTextarea-bfeb20e3.js";import{u as oe,A as ye}from"./Add-38c6b271.js";import{f as M}from"./formatters-12413ec5.js";import{V as W,a as ae}from"./VCard-a375baf5.js";import{a as X,V as p}from"./VRow-db2c24e9.js";import{V as re}from"./VDialog-fe67dd57.js";import{o as se,a as b,c as T,w as o,b as l,u as e,d as t,t as r,f as j,F as ce,p as pe,h as S,r as $,a6 as be,K as ge,V as Q,E as G,g as H,af as he,e as De,U as k}from"./main-c40ee4ed.js";import{_ as $e}from"./AppDateTimePicker-4011cefb.js";import{u as Ie,c as we}from"./Add-bc5c5574.js";import{V as Ce,r as F}from"./VForm-48297921.js";import{a as xe}from"./VList-4b19a862.js";import{V as Ue}from"./VDivider-e4e61359.js";import{V as ke}from"./VBadge-4b3a10d7.js";import"./VCheckboxBtn-609a0dc2.js";import"./VSelectionControl-84b50376.js";import"./VInput-135e03cb.js";import"./transition-127812ba.js";import"./VTextField-1b1d5e52.js";import"./forwardRefs-9d31fcaa.js";import"./VImg-3d39c17f.js";import"./VMenu-ebdbfbe8.js";import"./VOverlay-93ac4317.js";import"./VAvatar-1c4c29a7.js";import"./axios-da837377.js";import"./parse-263515be.js";import"./index.m-120058be.js";import"./_commonjsHelpers-725317a4.js";const Fe=t("p",{class:"text-sm text-uppercase text-disabled"}," Invoice Details ",-1),Se=t("th",null," Customer Name: ",-1),Te=t("th",null," Email: ",-1),Pe=["href"],Ae=t("th",null," Phone: ",-1),Ee=["href"],Ne=t("th",null," Address: ",-1),Be=t("th",null," Completion Date: ",-1),Re=t("th",null," Due Date: ",-1),Le=t("th",null," Notes: ",-1),qe=t("p",{class:"text-sm text-uppercase text-disabled"}," Invoice Items ",-1),Me=t("thead",null,[t("tr",null,[t("th",null,"Item Description"),t("th",null,"Item Quantity"),t("th",null,"Item Price"),t("th",null,"Item Total")])],-1),je={__name:"View",props:{isDialogVisible:{type:Boolean,required:!0},invoiceId:{type:Number,required:!0}},emits:["update:isDialogVisible","editCustomer","deleteCustomer"],setup(L,{emit:C}){const I=L,{getInvoice:Y,invoiceData:f}=oe();se(async()=>{I.isDialogVisible&&await Y(I.invoiceId)});const w=s=>{C("update:isDialogVisible",s)};return(s,V)=>{const q=ue;return b(),T(re,{width:s.$vuetify.display.smAndDown?600:"60%","model-value":L.isDialogVisible,"onUpdate:modelValue":w},{default:o(()=>[l(q,{onClick:V[0]||(V[0]=g=>w(!1))}),e(f).customer?(b(),T(W,{key:0},{default:o(()=>[l(X,null,{default:o(()=>[l(p,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[Fe,l(ie,null,{default:o(()=>[t("tbody",null,[t("tr",null,[Se,t("td",null,r(e(f).customer.name),1)]),t("tr",null,[Te,t("td",null,[t("a",{href:`mailto:${e(f).customer.email}`},r(e(f).customer.email),9,Pe)])]),t("tr",null,[Ae,t("td",null,[t("a",{href:`tel:${e(f).customer.phone}`},r(e(f).customer.phone),9,Ee)])]),t("tr",null,[Ne,t("td",null,r(e(f).customer.address),1)]),t("tr",null,[Be,t("td",null,r(e(f).completion_date),1)]),t("tr",null,[Re,t("td",null,r(e(f).due_date),1)]),t("tr",null,[Le,t("td",null,r(e(f).notes),1)])])]),_:1})]),_:1}),l(p,{cols:"12",lg:"6",md:"6",sm:"6"},{default:o(()=>[qe,l(ie,null,{default:o(()=>[Me,t("tbody",null,[(b(!0),j(ce,null,pe(e(f).items,(g,B)=>(b(),j("tr",{key:B},[t("td",null,r(g.description),1),t("td",null,r(g.quantity),1),t("td",null,r(e(M)(g.price)),1),t("td",null,r(e(M)(g.total)),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})):S("",!0)]),_:1},8,["width","model-value"])}}},Ye={key:0,class:"scrollable-table"},Oe=t("h3",{class:"font-weight-medium mb-3"}," Customer Details: ",-1),ze=t("td",{class:"pe-6"}," Name: ",-1),Je={class:"font-weight-semibold"},Qe=t("td",{class:"pe-6"}," Phone: ",-1),Ke=t("td",{class:"pe-6"}," Address: ",-1),Ge=t("td",{class:"pe-6"}," Lead Type: ",-1),He={class:"d-flex gap-2"},We={style:{width:"120px"}},Xe={style:{width:"160px"}},Ze={class:"my-2"},et=t("span",{class:"d-inline"},"Item Total: ",-1),tt={class:"text-body-1"},lt={class:"mt-4 ma-sm-2"},at={class:"mb-2"},ot={__name:"Edit",props:{isDialogVisible:{type:Boolean,required:!0},invoiceId:{type:Number,required:!1}},emits:["refetchData","update:isDialogVisible"],setup(L,{emit:C}){const I=L,Y=["Bank Account","Stripe","Paypal","Cash","Check"],f=["Draft","Unpaid","Paid","Overdue","Cancelled","Refunded"],w={completion_date:"",due_date:"",note:"",customer_id:"",estimate_id:"",payment_method:"",payment_status:"Draft",sub_total:0,tax_amount:0,total:0,items:[{id:1,type:"",location:"",service:"",description:"",price:0,discount:0,total:0}]},s=$({...w}),V=$({}),{getCustomer:q,customerData:g}=Ie(),{updateInvoice:B,errors:_e,respResult:Z,isLoading:ee,getInvoice:O,invoiceData:_}=oe(),{getEstimate:P,estimateData:x,fetchEstimatesList:A,estimates:E,isLoading:te}=we(),U=async m=>{await P(m),await q(x.value.customer_id),V.value=g.value,s.value.customer_id=g.value.id,s.value.estimate_id=x.value.id,s.value.items=[],x.value.items.forEach(i=>{s.value.items.push({id:s.value.items.length+1,type:i.type,location:i.location,service:i.service,description:i.description,price:i.price,discount:i.discount,total:i.total,discount_type:i.discount_type})}),R()};se(async()=>{I.isDialogVisible&&(await O(I.invoiceId),await A(),s.value={completion_date:_.value.completion_date,due_date:_.value.due_date,note:_.value.note,customer_id:_.value.customer_id,estimate_id:_.value.estimate_id,payment_method:_.value.payment_method,payment_status:_.value.payment_status,sub_total:_.value.sub_total,tax_amount:_.value.tax_amount,total:_.value.total,items:[]},_.value.items.forEach(m=>{s.value.items.push({id:s.value.items.length+1,type:m.type,location:m.location,service:m.service,description:m.description,price:m.price,discount:m.discount,total:m.total,discount_type:m.discount_type})}),await q(_.value.customer_id),V.value=g.value,s.value.customer_id=g.value.id,s.value.estimate_id=_.value.estimate_id,R())});const R=()=>{s.value.sub_total=0,s.value.total=0,s.value.items.forEach(m=>{s.value.sub_total+=parseFloat(m.total),s.value.total+=parseFloat(m.total)})},z=m=>{const i=s.value.items[m],{price:d,discount:h}=i;i.discount_type==="percentage"?i.total=parseFloat(d)-parseFloat(d)*parseFloat(h)/100:i.total=parseFloat(d)-parseFloat(h),i.total=parseFloat(d)-parseFloat(h),R()},K=()=>{s.value.items.push({id:s.value.items.length+1,type:"",location:"",service:"",description:"",price:0,discount:0,total:0,discount_type:"fixed"})},J=m=>{s.value.items.splice(m,1),R()},N=$(),le=()=>{s.value={...w},he(()=>{var m,i;(m=N.value)==null||m.reset(),(i=N.value)==null||i.resetValidation()})},y=async()=>{var m;(m=N.value)==null||m.validate().then(async({valid:i})=>{if(i){const d=new FormData;d.append("completion_date",s.value.completion_date),d.append("due_date",s.value.due_date),d.append("estimate_id",s.value.estimate_id),d.append("payment_method",s.value.payment_method),d.append("payment_status",s.value.payment_status),d.append("customer_id",s.value.customer_id),d.append("sub_total",s.value.sub_total),d.append("tax_amount",s.value.tax_amount),d.append("total",s.value.total),s.value.note&&d.append("note",s.value.note),d.append("_method","PUT");const h=s.value.items;for(let a=0;a<h.length;a++){const c=h[a];d.append(`items[${a}][type]`,c.type),d.append(`items[${a}][location]`,c.location),d.append(`items[${a}][service]`,c.service),d.append(`items[${a}][description]`,c.description),d.append(`items[${a}][price]`,c.price),d.append(`items[${a}][discount]`,c.discount),d.append(`items[${a}][discount_type]`,c.discount_type),d.append(`items[${a}][total]`,c.total)}try{await B(I.invoiceId,d),Z.value.status===200&&(C("refetchData"),C("update:isDialogVisible",!1),le())}catch(a){console.log(a)}}})},u=m=>{C("update:isDialogVisible",m)};return(m,i)=>{const d=ue,h=$e,a=me,c=de;return b(),T(re,{width:m.$vuetify.display.smAndDown?"auto":"80%","model-value":I.isDialogVisible,persistent:"","onUpdate:modelValue":u},{default:o(()=>[l(d,{onClick:i[0]||(i[0]=n=>u(!1))}),l(W,{title:"Update Invoice"},{default:o(()=>[l(ae,null,{default:o(()=>[l(Ce,{ref_key:"refForm",ref:N,onSubmit:be(y,["prevent"])},{default:o(()=>[l(X,null,{default:o(()=>[l(p,{cols:"12",md:"6"},{default:o(()=>[l(h,{modelValue:e(s).completion_date,"onUpdate:modelValue":i[1]||(i[1]=n=>e(s).completion_date=n),rules:[e(F)],density:"compact",label:"Select Completion Date",config:{altInput:!0,altFormat:"F j, Y",dateFormat:"d-m-Y",disableMobile:!0}},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:o(()=>[l(h,{modelValue:e(s).due_date,"onUpdate:modelValue":i[2]||(i[2]=n=>e(s).due_date=n),rules:[e(F)],density:"compact",label:"Select Due Date",config:{altInput:!0,altFormat:"F j, Y",dateFormat:"d-m-Y",disableMobile:!0}},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:o(()=>[l(a,{modelValue:e(s).estimate_id,"onUpdate:modelValue":[i[3]||(i[3]=n=>e(s).estimate_id=n),U],items:e(E),"item-title":"label","item-value":"id",label:"Select Estimate",class:"mb-6",density:"compact",loading:e(te),rules:[e(F)]},{item:o(({props:n,item:D})=>[l(xe,ge(n,{subtitle:` ${e(M)(D.raw.total)}`}),null,16,["subtitle"])]),_:1},8,["modelValue","items","loading","rules"])]),_:1}),l(p,{cols:"12",md:"12"},{default:o(()=>[e(V).name?(b(),j("div",Ye,[Oe,t("table",null,[t("tbody",null,[t("tr",null,[ze,t("td",Je,r(e(V).name),1)]),t("tr",null,[Qe,t("td",null,r(e(V).phone),1)]),t("tr",null,[Ke,t("td",null,r(e(V).address),1)]),t("tr",null,[Ge,t("td",null,r(e(V).lead_type),1)])])])])):S("",!0)]),_:1}),l(p,{cols:"12"},{default:o(()=>[(b(!0),j(ce,null,pe(e(s).items,(n,D)=>(b(),j("div",{key:D,class:"ma-sm-2 mb-2"},[l(W,{flat:""},{default:o(()=>[l(X,null,{default:o(()=>[l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[l(c,{modelValue:n.type,"onUpdate:modelValue":v=>n.type=v,rules:[e(F)],label:"Type"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[l(c,{modelValue:n.location,"onUpdate:modelValue":v=>n.location=v,rules:[e(F)],label:"Location"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[l(c,{modelValue:n.service,"onUpdate:modelValue":v=>n.service=v,rules:[e(F)],label:"Service"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[l(ne,{modelValue:n.description,"onUpdate:modelValue":v=>n.description=v,rows:"2",label:"Description",placeholder:"Description"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[l(c,{modelValue:n.price,"onUpdate:modelValue":[v=>n.price=v,v=>z(D)],rules:[e(F)],type:"number",min:"0",label:"Price"},null,8,["modelValue","onUpdate:modelValue","rules"])]),_:2},1024),l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[t("div",He,[t("div",We,[l(c,{modelValue:n.discount,"onUpdate:modelValue":[v=>n.discount=v,v=>z(D)],type:"number",min:"0",label:"Discount"},null,8,["modelValue","onUpdate:modelValue"])]),t("div",Xe,[l(a,{modelValue:n.discount_type,"onUpdate:modelValue":[v=>n.discount_type=v,v=>z(D)],items:[{value:"fixed",title:"Fixed"},{value:"percentage",title:"Percentage"}],label:"Discount Type",dense:""},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1024),l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[t("h3",Ze,[et,t("span",tt,r(e(M)(n.total)),1)])]),_:2},1024),l(p,{sm:"12",cols:"12",md:"3"},{default:o(()=>[l(Q,{icon:"",size:"x-small",color:"error",disabled:D===0,onClick:v=>J(D)},{default:o(()=>[l(G,{size:"20",icon:"tabler-x"})]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),t("div",lt,[l(Q,{onClick:K},{default:o(()=>[H(" Add Item ")]),_:1})])]),_:1}),l(p,{cols:"12",md:"6"},{default:o(()=>[l(a,{modelValue:e(s).payment_method,"onUpdate:modelValue":i[4]||(i[4]=n=>e(s).payment_method=n),items:Y,label:"Payment Method",class:"mb-6",density:"compact",rules:[e(F)]},null,8,["modelValue","rules"])]),_:1}),l(p,{cols:"12",md:"6"},{default:o(()=>[l(a,{modelValue:e(s).payment_status,"onUpdate:modelValue":i[5]||(i[5]=n=>e(s).payment_status=n),items:f,label:"Payment Status",class:"mb-6",density:"compact",rules:[e(F)]},null,8,["modelValue","rules"])]),_:1}),l(ae,{class:"d-flex justify-end flex-wrap flex-column flex-sm-row"},{default:o(()=>[t("h2",at," Total: "+r(e(M)(e(s).sub_total)),1)]),_:1}),l(p,{cols:"12",md:"12"},{default:o(()=>[l(ne,{modelValue:e(s).note,"onUpdate:modelValue":i[6]||(i[6]=n=>e(s).note=n),clearable:"","clear-icon":"tabler-circle-x",label:"Notes"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",class:"d-flex flex-wrap gap-4 justify-end"},{default:o(()=>[l(Q,{type:"submit",loading:e(ee),disabled:e(ee),onClick:i[7]||(i[7]=n=>{var D;return(D=e(N))==null?void 0:D.validate()})},{default:o(()=>[H(" Update Invoice ")]),_:1},8,["loading","disabled"]),l(Q,{color:"secondary",variant:"tonal",onClick:i[8]||(i[8]=n=>u(!1))},{default:o(()=>[H(" Cancel ")]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["width","model-value"])}}};const st={class:"me-3 d-flex gap-3"},it={key:1,class:"text-grey text-caption align-self-center"},nt={class:"d-flex align-center"},dt=["onClick"],ut=["href"],mt=["href"],rt={class:"d-flex align-center"},ct={class:"me-3"},pt={class:"d-flex align-center"},_t={class:"d-flex align-center"},vt=["onClick"],zt={__name:"Index",props:{customerId:{type:Number,required:!1}},setup(L){const C=L,{invoices:I,totalRecords:Y,isLoading:f,fetchInvoices:w,currentPage:s,headers:V,deleteInvoice:q,itemsPerPage:g,searchQuery:B,paginationData:_e,filters:Z,resolveInvoiceStatusVariantAndIcon:ee}=oe(),O=$([]),_=$(!1),P=$(!1),x=$(!1),A=$(!1),E=$(0),te=$(0);se(async()=>{C.customerId&&(te.value=C.customerId,Z.customerId=C.customerId),await w()});const U=$([]),R=()=>{const y=JSON.parse(localStorage.getItem("invoices.table"));y?U.value=y.filter(u=>u.visible===!0):U.value=V};R();const z=async y=>{V.forEach(u=>{u.visible=y.includes(u.title)}),localStorage.setItem("invoices.table",JSON.stringify(V)),R()},K=y=>{E.value=y,_.value=!0},J=y=>{E.value=y,P.value=!0},N=y=>{A.value=!0,E.value=y},le=async y=>{if(y===!1){A.value=!1;return}await q(E.value),A.value=!1,P.value=!1,await w()};return(y,u)=>{const m=me,i=de,d=De("IconBtn"),h=fe;return e(I)?(b(),T(W,{key:0,id:"invoice-list"},{default:o(()=>[l(ae,{class:"d-flex align-center flex-wrap gap-4"},{default:o(()=>[l(X,null,{default:o(()=>[l(p,{lg:"3",md:"3",sm:"4",cols:"12"},{default:o(()=>[t("div",st,[l(Q,{"prepend-icon":"tabler-plus",onClick:u[0]||(u[0]=a=>x.value=!0)},{default:o(()=>[H(" Create Invoice ")]),_:1})])]),_:1}),l(p,{lg:"3",md:"6",sm:"8",cols:"12"},{default:o(()=>[l(m,{modelValue:e(U),"onUpdate:modelValue":[u[1]||(u[1]=a=>k(U)?U.value=a:null),z],label:"Select Column Visibility ",multiple:"",eager:"",items:e(V)},{selection:o(({item:a,index:c})=>[c<4?(b(),T(Ve,{key:0},{default:o(()=>[t("span",null,r(a.title),1)]),_:2},1024)):S("",!0),c===4?(b(),j("span",it," (+"+r(e(U).length-4)+" others) ",1)):S("",!0)]),_:1},8,["modelValue","items"])]),_:1}),l(p,{lg:"3",md:"3",cols:"12",sm:"6"},{default:o(()=>[l(i,{modelValue:e(B),"onUpdate:modelValue":u[2]||(u[2]=a=>k(B)?B.value=a:null),label:"Search Invoices",density:"compact"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(Ue),l(e(ve),{modelValue:e(O),"onUpdate:modelValue":u[3]||(u[3]=a=>k(O)?O.value=a:null),"items-per-page":e(g),"onUpdate:itemsPerPage":u[4]||(u[4]=a=>k(g)?g.value=a:null),page:e(s),"onUpdate:page":u[5]||(u[5]=a=>k(s)?s.value=a:null),loading:e(f),"items-length":e(Y),headers:e(U),items:e(I),class:"text-no-wrap"},{"item.invoice_number":o(({item:a})=>[t("div",nt,[t("a",{href:"javascript:;",onClick:c=>J(a.raw.id)},r(a.raw.invoice_number),9,dt)])]),"item.customer.email":o(({item:a})=>[t("a",{href:`mailto:${a.raw.customer.email}`,class:"text-decoration-none"},r(a.raw.customer.email),9,ut)]),"item.customer.phone":o(({item:a})=>[t("a",{href:`tel:${a.raw.customer.phone}`,class:"text-decoration-none"},r(a.raw.customer.phone),9,mt)]),"item.total":o(({item:a})=>[t("div",rt,[t("span",ct,r(e(M)(a.raw.total)),1)])]),"item.status":o(({item:a})=>[t("div",pt,[a.raw.payment_status?(b(),T(ke,{key:0,content:a.raw.payment_status,color:"primary",class:"ms-3"},null,8,["content"])):S("",!0)])]),"item.title":o(({item:a})=>[t("div",_t,[t("a",{href:"javascript:;",onClick:c=>J(a.raw.id)},r(a.raw.title),9,vt)])]),"item.actions":o(({item:a})=>[l(d,{onClick:c=>N(a.raw.id)},{default:o(()=>[l(G,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),l(d,{onClick:c=>J(a.raw.id)},{default:o(()=>[l(G,{icon:"tabler-eye"})]),_:2},1032,["onClick"]),l(d,{onClick:c=>K(a.raw.id)},{default:o(()=>[l(G,{icon:"tabler-pencil"})]),_:2},1032,["onClick"])]),_:1},8,["modelValue","items-per-page","page","loading","items-length","headers","items"]),e(P)?(b(),T(je,{key:0,isDialogVisible:e(P),"onUpdate:isDialogVisible":u[6]||(u[6]=a=>k(P)?P.value=a:null),"invoice-id":e(E),onEditInvoice:K,onDeleteInvoice:N},null,8,["isDialogVisible","invoice-id"])):S("",!0),e(x)?(b(),T(ye,{key:1,isDialogVisible:e(x),"onUpdate:isDialogVisible":u[7]||(u[7]=a=>k(x)?x.value=a:null),onRefetchData:e(w)},null,8,["isDialogVisible","onRefetchData"])):S("",!0),e(_)?(b(),T(ot,{key:2,isDialogVisible:e(_),"onUpdate:isDialogVisible":u[8]||(u[8]=a=>k(_)?_.value=a:null),"invoice-id":e(E),onRefetchData:e(w)},null,8,["isDialogVisible","invoice-id","onRefetchData"])):S("",!0),l(h,{isDialogVisible:e(A),"onUpdate:isDialogVisible":u[9]||(u[9]=a=>k(A)?A.value=a:null),"cancel-title":"Cancelled","confirm-title":"Deleted","confirm-msg":"Invoice deleted successfully.","confirmation-question":"Are you sure you want to delete this invoice? This action cannot be undone.","cancel-msg":"Invoice deletion cancelled.",onConfirm:le},null,8,["isDialogVisible"])]),_:1})):S("",!0)}}};export{zt as default};
